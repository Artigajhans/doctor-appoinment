import{r,j as e,h as W,i as Z,k as q,l as J,m as U}from"./index-auPOeGcf.js";import{u as B,c as $,B as T}from"./Button-BiH8uvSj.js";import{C as V,R as X,a as p}from"./Row-CZIp6QZS.js";const w=r.forwardRef(({bsPrefix:i,bg:c="primary",pill:f=!1,text:l,className:h,as:d="span",...j},s)=>{const m=B(i,"badge");return e.jsx(d,{ref:s,...j,className:$(h,m,f&&"rounded-pill",l&&`text-${l}`,c&&`bg-${c}`)})});w.displayName="Badge";const C=r.forwardRef(({bsPrefix:i,variant:c,animation:f="border",size:l,as:h="div",className:d,...j},s)=>{i=B(i,"spinner");const m=`${i}-${f}`;return e.jsx(h,{ref:s,...j,className:$(d,m,l&&`${m}-${l}`,c&&`text-${c}`)})});C.displayName="Spinner";const ne=()=>{var k;const[i,c]=r.useState([]),{id:f}=W(),[l,h]=r.useState(""),[d,j]=r.useState({}),{data:s,isSuccess:m}=Z(f,{skip:!f}),{data:o,isSuccess:N}=q(),[I,{isLoading:y}]=J(),[Y]=U(),E=new Date().toISOString().split("T")[0],[n,S]=r.useState({doctorId:"",date:E,timeSlot:""}),H=t=>{const a={};return t.forEach(({day:D,startTime:u,endTime:_})=>{let A=[],[L,P]=u.split(":").map(Number),[z,Q]=_.split(":").map(Number),x=new Date;x.setHours(L,P,0);let v=new Date;for(v.setHours(z,Q,0);x<v;){let b=x.getHours(),M=x.getMinutes(),G=b>=12?"PM":"AM",g=b>12?b-12:b;g=g===0?12:g;const K=`${g}: ${M===0?"00":M} ${G}`;A.push(K),x.setMinutes(x.getMinutes()+30)}a[D]=A}),a},F=t=>{S({...n,[t.target.name]:t.target.value})},R=t=>{S(a=>({...a,timeSlot:t}))},O=t=>{var a;if(t.preventDefault(),!n.doctorId||!n.date||!n.timeSlot){alert("Please fill all fields!");return}I(n),S({doctorId:((a=s==null?void 0:s.result)==null?void 0:a._id)||"",date:"",timeSlot:""})};return r.useEffect(()=>{m&&(s!=null&&s.result)&&(S(t=>({...t,doctorId:s.result._id})),j(H(s.result.schedule)))},[m,s]),r.useEffect(()=>{if(n.date){const a=new Date(n.date).toLocaleDateString("en-IN",{weekday:"long",timeZone:"Asia/Kolkata"});h(a)}},[n.date]),r.useEffect(()=>{var t,a;if(N&&((t=o==null?void 0:o.result)!=null&&t.length)){const D=o.result.filter(u=>u.date===n.date).map(u=>u.timeSlot);c(((a=d[l])==null?void 0:a.filter(u=>!D.includes(u)))||[])}else c(d[l]||[])},[N,o,n.date,l,d]),e.jsxs("div",{className:"container",children:[e.jsx("h1",{children:"Book Appointment"}),e.jsxs("form",{onSubmit:O,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"doctorName",children:"Doctor"}),e.jsx("input",{type:"text",className:"form-control",name:"doctorName",value:((k=s==null?void 0:s.result)==null?void 0:k.name)||"",readOnly:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"date",children:"Date"}),e.jsx("input",{type:"date",className:"form-control",name:"date",value:n.date,onChange:F})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Time Slot"}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:i.length>0?i.map((t,a)=>e.jsx(w,{className:`badge-pill p-2 m-1 ${n.timeSlot===t?"bg-primary":"bg-secondary"}`,style:{cursor:"pointer"},onClick:()=>R(t),children:t},a)):e.jsxs("p",{className:"text-danger",children:["No slots available for ",l]})})]}),e.jsx(T,{type:"submit",className:"btn btn-primary mt-3",disabled:y,children:y?e.jsx(C,{animation:"border",size:"sm"}):"Book Appointment"})]}),e.jsx(V,{children:e.jsx(X,{children:o&&e.jsx(e.Fragment,{children:e.jsx(p,{className:"my-3",children:e.jsxs(p.Body,{children:[e.jsx(p.Title,{children:"Doctor Details"}),e.jsxs(p.Text,{children:["Doctor ID: ",o._id]}),e.jsxs(p.Text,{children:["Doctor Name: ",o.name]}),e.jsxs(p.Text,{children:["Doctor Mobile:",o.mobile]}),e.jsxs(p.Text,{children:["Doctor Specialization: ",o.specialization]}),e.jsx(T,{onClick:()=>cancelAppionment(o._id),className:"btn btn-danger btn-sm",children:"Cancel Appointment"})]})})})})})]})};export{ne as default};
